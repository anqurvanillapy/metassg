title:  Postocol

*Fork me on [GitHub](https://github.com/anqurvanillapy/postocol)!*

**Posting Protocol**, an opinionated abstract class for creating homemade static
site generator (SSG).

Ad Hoc Workflow, But Extensive
------------------------------

A simplified workflow of a single-page generator can mainly be like this:

```
                  load_templates()     publish()
                        |                  |
                        v                  v
(text.md) --+------- template ---+--> (index.html)
            |                    |
            +-- post ---> page --+
                 ^          ^
                 |          |
          load_posts()   render()
```

Load the `text.md` and render it using `python-markdown` and `BeautifulSoup4`.
In the meantime load the templates by `jinja2.Environment` and its
`FileSystemLoader`. Note that `render()` method is abstract and should be
implemented, where you could specify the manipulation of the preliminarily
rendered posts, e.g.

- creating your own table of contents,
- separating the Markdown text into different sections for creating a slideshow
presentation,
- collecting the posts' *tags*, *categories*, etc., generating a list for them.

By doing these above, you've extended your homemade SSG into a *wiki*-like tool,
and a *blog* has a similar workflow as well.

```
(foo.md) --+
(bar.md) --+  clean(site/)  load_templates()  publish()  send_static()
           |         |            |              |             |
           v         v            v              v             v
       (content/) ---+----- templates ---+--> (site/) --+-> (site/static/)
                     |                   |              +-- (index.html)
                     +-- posts -> pages -+              +-- (states.html)
                          ^         ^                   +-- (properties.html)
                          |         |                   +-- (foo.html)
                   load_posts()  render()               +-- (bar.html)
```

In this new one, you might need to clean the legacy generated pages ahead of
your publishing, and in the end of the control flow, send the static assets to
your `site/` folder, e.g. stylesheets, scripts, images.

All You Need Is Implementing One Abstract Method
------------------------------------------------

The method is `render()`, in the workflow graphs above.

This project site was initially generated by this following snippet, which looks
**weird** but would be concise if you've gone through Postocol's philosophy.

```python
from postocol import Postocol
from os.path import basename, splitext


class SSG(Postocol):
    ifpath = 'preface.md'
    ofpath = 'index.html'

    def run(self):
        self.tmpls = self.load_templates()
        self.posts = self.load_posts()
        self.pages = self.render(self.posts)
        self.publish(self.pages, self.tmpls)

    def render(self, posts):
        pages = []
        chfn = lambda x: '{}.html'.format(splitext(basename(x))[0])

        for c, m, f in posts:
            pages.append({'content': c, 'meta': m, 'fname': chfn(f)})

        return pages
```

Check Out The Repo For More Details
-----------------------------------

The repo is hosted on [GitHub](https://github.com/anqurvanillapy/postocol),
where there are a full manual on the `README.md` and an example of creating a
well-featured prototyped **wiki generator**.

```bash
$ git clone git@github.com:anqurvanillapy/postocol.git
$ cd postocol
$ python3 setup.py install
```

Anyway, feel free to create your issues, fork and pull your requests.

License
-------

MIT
